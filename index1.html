<!DOCTYPE html>
<html>
<head>
<title>Chessing</title>


<link rel="stylesheet" href="style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">


</head>
<body  style=" align-items: center;">
  <div style="display: inline;">
    <form style="display: inline;" action="https://localhost:3000" method="get">
      <input type="submit" value="Home">
    </form>
    <form style="display: inline;" action="https://localhost:3000/tornei" method="get">
      <input type="submit" value="Tornei">
    </form>
    <form style="display: inline;" action="https://localhost:3000/s" method="get">
      <input type="submit" value="Twitch Streamer Live">
    </form>
  </div>
  

<div style="display: flex;">
<div style="display: inline;">
  <table class="tabella" style="font-size: 45px; text-align: center;margin-left: auto;margin-right: auto;">
    <tr>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,0)"><i id="A8" class="fas fa-chess-rook" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,1)"><i id="B8" class="fas fa-chess-knight" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,2)"><i id="C8" class="fas fa-chess-bishop" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,3)"><i id="D8" class="fas fa-chess-queen" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,4)"><i id="E8" class="fas fa-chess-king" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,5)"><i id="F8" class="fas fa-chess-bishop" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,6)"><i id="G8" class="fas fa-chess-knight" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(0,7)"><i id="H8" class="fas fa-chess-rook" style="color:black;"></i></td>
    </tr>

    <tr>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,0)"><i id="A7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,1)"><i id="B7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,2)"><i id="C7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,3)"><i id="D7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,4)"><i id="E7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,5)"><i id="F7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,6)"><i id="G7" class="fas fa-chess-pawn" style="color:black;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(1,7)"><i id="H7" class="fas fa-chess-pawn" style="color:black;"></i></td>
    </tr>

    <tr>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,0)"><i id="A6"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,1)"><i id="A6"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,2)"><i id="B6"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,3)"><i id="B6"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,4)"><i id="A6"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,5)"><i id="B6"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,6)"><i id="B6"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(2,7)"><i id="B6"></i></td>
    </tr>
    
    <tr>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,0)"><i id="A5"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,1)"><i id="A5"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,2)"><i id="B5"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,3)"><i id="B5"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,4)"><i id="A5"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,5)"><i id="B5"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,6)"><i id="B5"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(3,7)"><i id="B5"></i></td>
    </tr>

    <tr>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,0)"><i id="A4"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,1)"><i id="A4"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,2)"><i id="B4"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,3)"><i id="B4"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,4)"><i id="A4"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,5)"><i id="B4"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,6)"><i id="B4"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(4,7)"><i id="B4"></i></td>
    </tr>

    <tr>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,0)"><i id="A3"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,1)"><i id="A3"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,2)"><i id="B3"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,3)"><i id="B3"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,4)"><i id="A3"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,5)"><i id="B3"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,6)"><i id="B3"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(5,7)"><i id="B3"></i></td>
    </tr>
    
    <tr>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,0)"><i id="A2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,1)"><i id="B2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,2)"><i id="C2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,3)"><i id="D2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,4)"><i id="E2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,5)"><i id="F2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,6)"><i id="G2" class="fas fa-chess-pawn" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(6,7)"><i id="H2" class="fas fa-chess-pawn" style="color:white;"></i></td>
    </tr>

    <tr>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,0)"><i id="A1" class="fas fa-chess-rook" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,1)"><i id="B1" class="fas fa-chess-knight" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,2)"><i id="C1" class="fas fa-chess-bishop" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,3)"><i id="D1" class="fas fa-chess-queen" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,4)"><i id="E1" class="fas fa-chess-king" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,5)"><i id="F1" class="fas fa-chess-bishop" style="color:white;"></i></td>
      <td style="background-color: sienna;border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,6)"><i id="G1" class="fas fa-chess-knight" style="color:white;"></i></td>
      <td style="background-color: tan; border:1px solid #000000; width: 1.4cm; height:1.4cm;" onclick="myFunction(7,7)"><i id="H1" class="fas fa-chess-rook" style="color:white;"></i></td>
    </tr>

  </table>
</div>
<div style="display: inline; margin-left: auto;margin-right: auto;">
  <button id="send">Cerca Partita</button>
  <br>
  <p><strong>Linee Consigliate</strong></p>
  <div id="linea1"></div>
  <div id="linea2"></div>
  <div id="linea3"></div>
  <br>
  <div id="output"></div>
  <br>
</div>
</div>
  <h1> CHAT </h1>
  <input id="message" type="text" placeholder="inserisci il messaggio"/>
  <button id="send_message">Manda messaggio</button>
  <div id="chatte"></div>
  <br>
  
  
<h1> SALVA PARTITA </h1>
Inserisci il tuo nickname<input id="nome" value="" type="text"/>
<button id="salva">Salva Partita</button>
<div id="salva_output>"></div>
<br>


<form action="https://localhost:3000/get/partite" method="get">
  <h1> Inserisci il tuo nome per ricevere le partite che hai giocato!</h1>
  Nome:<br>
  <div name="uri" value="/my_database"></div>
  <input type="text" name="nome" value="">
  <br>

  <input type="submit" value="Submit">
</form>


<script src="/socket.io/socket.io.js"></script>
<script>


//    0   1   2   3   4   5   6   7
//    8   9   10  11  12  13  14  15
//    16  17  18  19  20  21  22  23
//    24  25  26  27  28  29  30  31
//    32  33  34  35  36  37  38  39
//    40  41  42  43  44  45  46  47
//    48  49  50  51  52  53  54  55
//    56  57  58  59  60  61  62  63

//-----------------------------------------------
//-------------FUNZIONE SCACCHI------------------
//-----------------------------------------------
//-----------------------------------------------


var type="";
var color =["N","N","N","N","N","N","N","N","N","N","N","N","N","N","N","N",
          "O","O","O","O","O","O","O","O","O","O","O","O","O","O","O","O",
          "O","O","O","O","O","O","O","O","O","O","O","O","O","O","O","O",
          "B","B","B","B","B","B","B","B","B","B","B","B","B","B","B","B"];
var pos_init;
var pos_fine;
var x_init;
var y_init;
var turn;
var mio_colore;
var partita_finita;

//document.getElementById("demo").innerHTML = pos_fine;

// FUNZIONI TORRI
function prossima_y_sinistra(q,w){
  for(j=w-1;j>0;j--){
    if(color[q*8+j]!="O"){
      return j;
    }
  }
  return j;
}

function prossima_y_destra(q,w){
  for(j=w+1;j<8;j++){
    if(color[q*8+j]!="O"){
      return j;
    }
  }
  return j;
}

function prossima_x_sopra(q,w){
  for(j=q-1;j>=0;j--){
    if(color[j*8+w]!="O"){
      return j;
    }
  }
  return j;
}


// FUNZIONI ALFIERE

function prossima_y_destra_sotto(q,w){
  for(o=q+1,p=w+1;o<8 && p<8;o++,p++){
    if(color[o*8+p]!="O"){
      return p;
    }
  }
  return p;
}

function prossima_y_sinistra_sotto(q,w){
  for(o=q+1,p=w-1;o<8 && p>0;o++,p--){
    if(color[o*8+p]!="O"){
      return p;
    }
  }
  return p;
}

function prossima_y_destra_sopra(q,w){
  for(o=q-1,p=w+1;o>0 && p<8;o--,p++){
    if(color[o*8+p]!="O"){
      return p;
    }
  }
  return p;
}

function prossima_y_sinistra_sopra(q,w){
  for(o=q-1,p=w-1;o>0 && p>0;o--,p--){
    if(color[o*8+p]!="O"){
      return p;
    }
  }
  return p;
}

//-----------------------------AGGIORNAMENTO-------------------------------------

function promozione(arrivo){
  document.getElementsByTagName("I")[arrivo].className = "fas fa-chess-queen";
}

function aggiorna(partenza,arrivo,tipo){
  color[arrivo]=color[partenza];
  color[partenza]="O";
  document.getElementsByTagName("I")[partenza].className = "";
  document.getElementsByTagName("I")[arrivo].style.color=document.getElementsByTagName("I")[partenza].style.color;
  document.getElementsByTagName("I")[partenza].style.color="";
  document.getElementsByTagName("I")[arrivo].className = tipo;
  type="";
}


function controllo(x,y) {
  pos_fine=x*8+y;
  //document.getElementById("demo").innerHTML = pos_fine+"  "+ pos_init+"  "+ type+"   x_init"+ x_init+" x "+ x+ "  y_init "+ y_init+" y"+ y;
  if(color[pos_fine]==color[pos_init]){
    type="";
  }
  //---------------------------------------------------------------------
  //-------------------------------TORRE---------------------------------
  //---------------------------------------------------------------------
  else if(type=="torre"){
    pezzo="fas fa-chess-rook";
    if(x==x_init && y>y_init){     
      y_prox=prossima_y_destra(x,y_init);                                  // A DESTRA
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x==x_init && y<y_init){                                     // A SINISTRA
      y_prox=prossima_y_sinistra(x,y_init);                                  
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(y==y_init && x<x_init){                                     // SOPRA
      x_prox=prossima_x_sopra(x_init,y);                                  
      if(x_prox<=x){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }

    else if(y==y_init && x>x_init){                                     // SOTTO
      for(j=pos_init+8;j<pos_fine;j=j+8){
        if(color[j]!="O"){
          type="";
        }
      }
      if(type=="torre"){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
    }
  }
  //---------------------------------------------------------------------
  //-------------------------------CAVALLO-------------------------------
  //---------------------------------------------------------------------
  else if(type=="cavallo"){
    pezzo="fas fa-chess-knight";
    if((((x_init-x)**2==1) && ((y_init-y)**2==4))||(((x_init-x)**2==4) && ((y_init-y)**2==1))){
      socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
    }
    type="";
  }


  //---------------------------------------------------------------------
  //-------------------------------ALFIERE-------------------------------
  //---------------------------------------------------------------------

  else if(type=="alfiere"){
    pezzo="fas fa-chess-bishop";
    if(x>x_init && x-x_init==y-y_init){
      y_prox=prossima_y_destra_sotto(x_init,y_init);                                  // A DESTRA-SOTTO
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x>x_init && x-x_init==y_init-y){                                     // A SINISTRA_SOTTO
      y_prox=prossima_y_sinistra_sotto(x_init,y_init);                                  
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x_init-x==y-y_init){                                     // DESTRA_SOPRA
      y_prox=prossima_y_destra_sopra(x_init,y_init);                                  
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    else if(x_init-x==y_init-y){                                     // SINISTRA_SOPRA
      y_prox=prossima_y_sinistra_sopra(x_init,y_init);
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
  }

  //---------------------------------------------------------------------
  //-------------------------------RE-------------------------------
  //---------------------------------------------------------------------

  else if(type=="re"){
    pezzo="fas fa-chess-king";
    if((x_init-x==1 || x_init-x==0 || x_init-x==-1)&&(y_init-y==1 || y_init-y==-1 || y_init-y==0)){
      socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
    }
    type="";
  }

  //---------------------------------------------------------------------
  //-------------------------------REGINA-------------------------------
  //---------------------------------------------------------------------

  else if(type=="regina"){
    pezzo="fas fa-chess-queen";
    if(x==x_init && y>y_init){     
      y_prox=prossima_y_destra(x,y_init);                                  // A DESTRA
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x==x_init && y<y_init){                                     // A SINISTRA
      y_prox=prossima_y_sinistra(x,y_init);                                  
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(y==y_init && x<x_init){                                     // SOPRA
      x_prox=prossima_x_sopra(x_init,y);                                  
      if(x_prox<=x){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }

    else if(y==y_init && x>x_init){                                     // SOTTO
      for(j=pos_init+8;j<pos_fine;j=j+8){
        if(color[j]!="O"){
          type="";
        }
      }
      if(type=="regina"){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
    }
    else if(x>x_init && x-x_init==y-y_init){
      y_prox=prossima_y_destra_sotto(x_init,y_init);                                  // A DESTRA-SOTTO
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x>x_init && x-x_init==y_init-y){                                     // A SINISTRA_SOTTO
      y_prox=prossima_y_sinistra_sotto(x_init,y_init);                                  
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    
    else if(x_init-x==y-y_init){                                     // DESTRA_SOPRA
      y_prox=prossima_y_destra_sopra(x_init,y_init);                                  
      if(y_prox>=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
    else if(x_init-x==y_init-y){                                     // SINISTRA_SOPRA
      y_prox=prossima_y_sinistra_sopra(x_init,y_init);
      if(y_prox<=y){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
      type="";
    }
  }

  //---------------------------------------------------------------------
  //-------------------------------PEDONE-------------------------------
  //---------------------------------------------------------------------

  else if(type=="pedone"){
    
    pezzo="fas fa-chess-pawn";
    if((color[pos_init]=="B" && (x_init-x==1 || (x_init-x==2 && x_init==6))) || (color[pos_init]=="N" && (x-x_init==1 || (x-x_init==2 && x_init==1)))){
      if((((x_init-x)**2!=4 && (y-y_init)**2==1) && color[pos_init]!=color[pos_fine] && color[pos_fine]!="O") || (y-y_init==0 && color[pos_fine]=="O")){
        socket.emit('on_move',data={
          partenza:pos_init,
          arrivo:pos_fine,
          tipo:pezzo
        });
      }
    }
    type="";
  }
}


function myFunction(i,j) {
  
  var pos=i*8+j;
	if(type=="" && turn==1 && color[pos]==mio_colore){
      x_init=i;
      y_init=j;
      pos_init=pos;
      var k= document.getElementsByTagName("I");
      if(k[pos].className=="fas fa-chess-rook"){
        type="torre";
      }
      else if(k[pos].className=="fas fa-chess-knight"){
        type="cavallo";
      }
      else if(k[pos].className=="fas fa-chess-bishop"){
        type="alfiere";
      }
      else if(k[pos].className=="fas fa-chess-king"){
        type="re";
      }
      else if(k[pos].className=="fas fa-chess-queen"){
        type="regina";
      }
      else if(k[pos].className=="fas fa-chess-pawn"){
        type="pedone";
      }
    }
    else if(turn==1){
      controllo(i,j);
    }
}

//-----------------------------------------------
//-----------------------------------------------
//-----------------------------------------------


var socket = io.connect("https://localhost:3000");

var mex=document.getElementById('message');
var output=document.getElementById('output');
var chatte=document.getElementById('chatte');
var btn=document.getElementById('send');
var btn_mex=document.getElementById('send_message');
var salva_partita=document.getElementById('salva');
var nome=document.getElementById('nome');
var sal=document.getElementById('salva_output');

//SALVA PARTITA

salva_partita.addEventListener('click',function(){
  if(nome.value!=""){
    socket.emit('salva_partita',nome.value);
    sal.innerHTML ='<p><strong>'+" : Partita Salvata nel database riferito a "+'</strong>'+'</p>';
  }
});


// INVIA MESSAGGIO
var mittente="avversario";

btn_mex.addEventListener('click',function(){
  mittente="Tu";
  socket.emit('chat',mex.value);
  mex.value = '';
});



socket.on('chat',function(data){
  chatte.innerHTML +='<p><strong>'+mittente+" : "+data+'</strong>'+'</p>';
  mittente="avversario";
});


// CERCA PARTITA

btn.addEventListener('click',function(){
  socket.emit('join_room');
});

socket.on('chi_inizia',function(data){
  mio_colore=data.mio_colore;
  if(mio_colore=="N")socket.emit('inizializza_contatore_nero')
  turn=data.make_turn;
  output.innerHTML +='<p><strong>'+" colore = "+mio_colore+turn+'</strong>'+'</p>';
});

socket.on('inizio',function(data){
  partita_finita=0;
  output.innerHTML +='<p><strong>'+"room : "+data+'</strong>'+'</p>';
});

socket.on('vittoria',function(data){
  output.innerHTML +='<p><strong>'+"Hai vinto per abbandono!!! : "+'</strong>'+'</p>';
  turn=0;
  partita_finita=1;
});
socket.on('matto',function(data){
  output.innerHTML +='<p><strong>'+"Scacco Matto! Ha vinto il "+data.colore+'</strong>'+'</p>';
  turn=0;
  partita_finita=1;
  aggiorna(data.partenza,data.arrivo,data.tipo);
});
socket.on('stallo',function(){
  output.innerHTML +='<p><strong>'+"Stallo."+'</strong>'+'</p>';
  turn=0;
  partita_finita=1;
});

socket.on('next_move',function(data){
  var scacco="";
  if(data.scacco)scacco="Scacco!";
  output.innerHTML +='<p><strong>'+scacco+data.last_move+'</strong>'+'</p>';
  if(data.colore!=mio_colore){
    linea1.innerHTML ='<p><strong> 1° Linea : '+data.linea[0]+'</strong>'+'</p>';
    linea2.innerHTML ='<p><strong> 2° Linea : '+data.linea[1]+'</strong>'+'</p>';
    linea3.innerHTML ='<p><strong> 3° Linea : '+data.linea[2]+'</strong>'+'</p>';
  }
  if(turn==1)turn=0;
  else turn=1;
  aggiorna(data.partenza,data.arrivo,data.tipo);
  promozione(arrivo);
});

</script>


</body>
</html>
